
#########################################################
# build stuff

SUBDIRS=src http webcam libvbi libng libng/plugins radio tools cc man @SUBS@

all build: $(SUBDIRS)
.PHONY: $(SUBDIRS)


src: libvbi libng .havedeps
	(cd $@; $(MAKE) build)

http: libvbi .havedeps
	(cd $@; $(MAKE) build)

webcam: libng .havedeps
	(cd $@; $(MAKE) build)

libvbi libng libng/plugins radio font tools cc man: .havedeps
	(cd $@; $(MAKE) build)


.havedeps dep depend:
	set -ex; for dir in $(SUBDIRS); do	\
		(cd $$dir; $(MAKE) depend)	\
	done
	touch .havedeps

install clean distclean realclean::
	set -ex; for dir in $(SUBDIRS); do	\
		(cd $$dir; $(MAKE) $@)		\
	done

distclean realclean::
	-rm -f *~ debian/*~ xpm/*~ Makefile Make.config .havedeps
	-rm -f config.cache config.h config.log config.status
	cp Makefile.clean Makefile


#########################################################
# just for me, some maintaining jobs.  Don't use them

VERSION=@XAWTV_VERSION@

checkit: distclean
	dpkg-buildpackage -tc -us -uc -rfakeroot
#	rpm -ta ../xawtv_*.tar.gz
	lintian ../xawtv_*.changes

release: distclean
	dpkg-buildpackage -tc -rfakeroot

port:
	dpkg-buildpackage -b -tc -rfakeroot

tarball: distclean
	(cd ..; tar cvzf xawtv_$(VERSION).tar.gz \
		xawtv-$(VERSION))

snapshot: distclean
	(cd ..; tar cvzf xawtv-snap-`date +%Y-%m-%d`.tar.gz \
		xawtv-$(VERSION))

auto:
	rm -f config.cache
	autoconf
	autoheader
	./configure
	make distclean
	make

realclean::
	find . -name snap0*.ppm  -print | xargs -i rm -f
	find . -name snap0*.jpeg -print | xargs -i rm -f
	find . -name .nfs* -print | xargs -i rm -f
	set -e; for dir in i2c; do make -C $$dir distclean; done

