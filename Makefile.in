
SUBDIRS=src man radio font tools #i2c webcam 

all dep depend install clean distclean realclean::
	set -e; for dir in $(SUBDIRS); do make -C $$dir $@; done

distclean realclean::
	-rm -f *~ config.cache config.h config.log config.status Makefile
	@echo "default:" > Makefile
	@echo "	./configure && make dep && make" >> Makefile


###########################################
# just for me, some maintaining jobs...

DEST=$(HOME)/www/v4l
RPM=/home/ftp/rpm
VERSION=@XAWTV_VERSION@

tar: distclean
	find . -name snap0*.ppm  -print | xargs -i rm -f
	find . -name snap0*.jpeg -print | xargs -i rm -f
	make -C vtx distclean
	cd ..;tar cvzf $(DEST)/xawtv-$(VERSION).tar.gz xawtv-$(VERSION)
	rm -f $(RPM)/SOURCES/xawtv-*.tar.gz
	cp $(DEST)/xawtv-$(VERSION).tar.gz $(RPM)/SOURCES

diff: distclean 
	echo $(VERSION)
	(cd /tmp; tar xvzf `ls -t $(HOME)/2/src/Archives/xawtv-*.tar.gz | head -n 1`)
	(cd ..; diff -urN /tmp/xawtv-* xawtv-$(VERSION) | gzip > $(DEST)/xawtv-$(VERSION).diff.gz)
	rm -rf /tmp/xawtv-*

dist: tar diff

